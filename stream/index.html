<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Stream 笔记 | 公孙二狗</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Stream 是 Java8 中处理集合的关键抽象概念，它可以指定你希望对集合进行的操作，可以执行非常复杂的查找、过滤和映射数据等操作。   Stream 中的方法单独拿出来使用的话体现不出其优点，在复杂的操作情况下，Stream 的优势才明显，例如下面这样生成不重复有序随机数的例子，如果用传统的写法代码会很长，还需要 if else 判断，使用临时集合等截断，去重等复杂操作，使用 Stream">
<meta property="og:type" content="article">
<meta property="og:title" content="Stream 笔记">
<meta property="og:url" content="http://xtuer.github.io/stream/index.html">
<meta property="og:site_name" content="公孙二狗">
<meta property="og:description" content="Stream 是 Java8 中处理集合的关键抽象概念，它可以指定你希望对集合进行的操作，可以执行非常复杂的查找、过滤和映射数据等操作。   Stream 中的方法单独拿出来使用的话体现不出其优点，在复杂的操作情况下，Stream 的优势才明显，例如下面这样生成不重复有序随机数的例子，如果用传统的写法代码会很长，还需要 if else 判断，使用临时集合等截断，去重等复杂操作，使用 Stream">
<meta property="og:locale">
<meta property="og:image" content="http://xtuer.github.io/img/java/stream.jpg">
<meta property="og:image" content="http://xtuer.github.io/img/java/stream-filter.jpg">
<meta property="og:image" content="http://xtuer.github.io/img/java/stream-map.jpg">
<meta property="og:image" content="http://xtuer.github.io/img/java/stream-flatmap.jpg">
<meta property="og:image" content="http://xtuer.github.io/img/java/stream-skip.jpg">
<meta property="og:image" content="http://xtuer.github.io/img/java/stream-limit.jpg">
<meta property="article:published_time" content="2020-05-24T01:08:08.000Z">
<meta property="article:modified_time" content="2021-12-02T22:29:07.187Z">
<meta property="article:author" content="公孙二狗">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xtuer.github.io/img/java/stream.jpg">
  
    <link rel="alternative" href="/atom.xml" title="公孙二狗" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/dog.png">
  
  
<link rel="stylesheet" href="/css/style.css">


  <!-- <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <!-- <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> -->
  <!-- <script src="//cdn.bootcss.com/require.js/2.3.6/require.min.js"></script> -->
  <link href="/css/fonts/font-awesome.min.css" rel="stylesheet">
  <script src="/js/jquery.min.js"></script>
  <script src="/js/require.min.js"></script>
  <script src="/js/main.js"></script>

  <!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
  <!-- <script src="https://hm.baidu.com/hm.js?22778d8041aa1437b11529a3e87a0a12"></script> -->
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
    <div id="container">
        <div class="left-col">
            <div class="content-table">Content Table</div>
            <div class="overlay"></div>

<ul class="menu">
    <!-- <li class="item"><a href="javascript:void(0)" id="baidu-search-button">百度搜索</a></li> -->
    <!-- <li class="item"><a href="javascript:void(0)" id="google-search-button">谷歌搜索</a></li> -->
    <!-- <li class="item non-index-item"><a href="javascript:void(0)" id="show-toc-button">显示目录</a></li> -->
</ul>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/dog.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/all/">公孙二狗</a></h1>
		</hgroup>
		<p style=" margin-bottom: 10px;margin-top: -5px;">
			<a style="color: gray;" target="_blank" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&uin=26664141&site=qq&menu=yes">QQ: 26664141</a>
		</p>

		
		<p class="header-subtitle">大圣，此去欲何？踏南天，碎凌霄。若一去不回……？便一去不回！</p>
		
		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-ribbon" data-idx="1">
							<div class="ribbon"></div>
						</div>
						<div class="icon-wrap icon-house hide" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Tags</li>
						<li>Menu</li>
						
						<li>Links</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				
				<section class="switch-part switch-part1">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Ajax/" style="font-size: 10.63px;">Ajax</a> <a href="/tags/Cas/" style="font-size: 12.5px;">Cas</a> <a href="/tags/DB/" style="font-size: 15.63px;">DB</a> <a href="/tags/FE/" style="font-size: 20px;">FE</a> <a href="/tags/Go/" style="font-size: 10px;">Go</a> <a href="/tags/Gradle/" style="font-size: 14.38px;">Gradle</a> <a href="/tags/Hexo/" style="font-size: 12.5px;">Hexo</a> <a href="/tags/Index/" style="font-size: 13.13px;">Index</a> <a href="/tags/Java/" style="font-size: 19.38px;">Java</a> <a href="/tags/Mac/" style="font-size: 17.5px;">Mac</a> <a href="/tags/Misc/" style="font-size: 17.5px;">Misc</a> <a href="/tags/PHP/" style="font-size: 11.25px;">PHP</a> <a href="/tags/Qt/" style="font-size: 18.13px;">Qt</a> <a href="/tags/QtBook/" style="font-size: 18.75px;">QtBook</a> <a href="/tags/Redis/" style="font-size: 11.25px;">Redis</a> <a href="/tags/SemanticUi/" style="font-size: 14.38px;">SemanticUi</a> <a href="/tags/Spring/" style="font-size: 11.88px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 13.75px;">SpringBoot</a> <a href="/tags/SpringCore/" style="font-size: 16.25px;">SpringCore</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/SpringSecurity/" style="font-size: 15.63px;">SpringSecurity</a> <a href="/tags/SpringWeb/" style="font-size: 17.5px;">SpringWeb</a> <a href="/tags/Util/" style="font-size: 17.5px;">Util</a> <a href="/tags/Vue/" style="font-size: 16.88px;">Vue</a> <a href="/tags/zTree/" style="font-size: 11.88px;">zTree</a>
                    </div>
                    <script>

                    </script>
				</section>
				

				<section class="switch-part switch-part2">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>

				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://loadship.cn">小鱼人</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://qtnull.com/">千古</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">吞风吻雨葬落日未曾彷徨，欺山赶海践雪径也未绝望，拈花把酒偏折煞世人情狂，凭这两眼与百臂或千手不能防，天阔阔雪漫漫共谁同航，这沙滚滚水皱皱笑着浪荡，贪欢一晌偏教那女儿情长埋葬。</div>
				</section>
				
			</div>
		</div>
        <div class="links-area" style="margin-top: 10px;">
            <a href="/html/tools">收藏夹 |</a>
            <a href="/qtbook">Qt 杂谈 |</a>
            <a href="/html/vue-in-action">Vue 实践</a>
            <a href="/html/spring-boot">Spring Boot |</a>
            <a href="/spring-web-index">Java Web 开发</a>
        </div>
	</header>
</div>

<script>
    $(document).ready(function() {
        // Baidu 搜索
        // $('#baidu-search-button').click(function(event) {
        //     layer.prompt({title: false, formType: 0, closeBtn: 0, maxlength: 140}, function(text, index) {
        //         layer.close(index);
        //         window.open('https://www.baidu.com/s?wd=site:qtdebug.com+'+text);
        //     });
        // });
        //
        // // Google 搜索
        // $('#google-search-button').click(function(event) {
        //     layer.prompt({title: false, formType: 0, closeBtn: 0, maxlength: 140}, function(text, index) {
        //         layer.close(index);
        //         window.open('https://www.google.com/?#q=site:qtdebug.com+'+text);
        //     });
        // });
    });

    function resetTags() {
		var tags = $(".tagcloud a");
		tags.css({"font-size": "12px"});
		for(var i=0,len=tags.length; i<len; i++){
			var num = tags.eq(i).html().length % 5 +1;
			tags[i].className = "";
			tags.eq(i).addClass("color"+num);
		}
    }

    resetTags();
</script>

        </div>
        <div class="mid-col">
            <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img src="/img/dog.png" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>

            <div class="body-wrap"><!-- 生成目录 -->

    <div id="toc-mask" style="display: none;">
        <div class="toc-container">
            <div class="article-toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-Stream"><span class="toc-text">创建 Stream</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#forEach"><span class="toc-text">forEach</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#peek"><span class="toc-text">peek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filter"><span class="toc-text">filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#map"><span class="toc-text">map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flatMap"><span class="toc-text">flatMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#skip"><span class="toc-text">skip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#limit"><span class="toc-text">limit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Class-User"><span class="toc-text">Class User</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#distinct"><span class="toc-text">distinct</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reduce"><span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sorted"><span class="toc-text">sorted</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toList"><span class="toc-text">toList</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toSet"><span class="toc-text">toSet</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toMap"><span class="toc-text">toMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#groupingBy"><span class="toc-text">groupingBy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#anyMatch"><span class="toc-text">anyMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E7%BB%93%E6%9E%84%E5%8C%96%E4%B8%80%E4%B8%AA-List"><span class="toc-text">树结构化一个 List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%82%E6%9C%80%E5%B0%8F%E5%80%BC"><span class="toc-text">求最小值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#int-%E6%95%B0%E7%BB%84%E8%BD%AC%E4%B8%BA-List"><span class="toc-text">int 数组转为 List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%91%E7%8E%87%E7%BB%9F%E8%AE%A1"><span class="toc-text">频率统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1"><span class="toc-text">词频统计</span></a></li></ol>
            </div>
        </div>
    </div>


<article id="post-stream" class="article article-type-post" itemscope itemprop="blogPost">
    <!-- 
        <div class="content-table">Content Table</div>
     -->

    
        <div class="article-meta">
            <a href="/stream/" class="article-date">
  	<!-- <time datetime="2020-05-24T01:08:08.000Z" itemprop="datePublished">2020-05-24</time> -->
    2020-05-24
</a>

        </div>
    

    
        <div class="article-inner article-inner-x">
    
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Stream 笔记
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>
	</div>


        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
        
            <p>Stream 是 Java8 中处理集合的关键抽象概念，它可以指定你希望对集合进行的操作，可以执行非常复杂的查找、过滤和映射数据等操作。</p>
<img src="../img/java/stream.jpg">

<p>Stream 中的方法单独拿出来使用的话体现不出其优点，在复杂的操作情况下，Stream 的优势才明显，例如下面这样生成不重复有序随机数的例子，如果用传统的写法代码会很长，还需要 if else 判断，使用临时集合等截断，去重等复杂操作，使用 Stream 的方式的话，逻辑看上去就清晰很多:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Double&gt; stream = Stream.generate(Math::random) <span class="comment">// double 无限流</span></span><br><span class="line">    .limit(<span class="number">20</span>)                                        <span class="comment">// 截断，取前 20 个</span></span><br><span class="line">    .filter(x -&gt; x &gt; <span class="number">0.3</span>)                             <span class="comment">// 过滤，取大于 0.3 的元素</span></span><br><span class="line">    .skip(<span class="number">1</span>)                                          <span class="comment">// 忽略，丢弃第一个元素</span></span><br><span class="line">    .distinct()                                       <span class="comment">// 去重</span></span><br><span class="line">    .map(x -&gt; x * <span class="number">10</span>)                                 <span class="comment">// 映射，将每个元素扩大 10 倍</span></span><br><span class="line">    .sorted();                                        <span class="comment">// 对 double 流进行排序</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>Stream 的常用方法有:</p>
<table>
<thead>
<tr>
<th>方法</th>
</tr>
</thead>
<tbody><tr>
<td><code>forEach(Consumer&lt;? super T&gt; action)</code></td>
</tr>
<tr>
<td><code>peek(Consumer&lt;? super T&gt; action)</code></td>
</tr>
<tr>
<td><code>filter(Predicate&lt;? super T&gt; predicate)</code></td>
</tr>
<tr>
<td><code>map(Function&lt;? super T, ? extends R&gt; mapper)</code></td>
</tr>
<tr>
<td><code>flatMap(Function&lt;? super T, ? extends Stream&lt;? extends R&gt;&gt; mapper)</code></td>
</tr>
<tr>
<td><code>skip(long n)</code></td>
</tr>
<tr>
<td><code>limit(long maxSize)</code></td>
</tr>
<tr>
<td><code>distinct()</code></td>
</tr>
<tr>
<td><code>reduce(BinaryOperator&lt;T&gt; accumulator)</code></td>
</tr>
<tr>
<td><code>reduce(T identity, BinaryOperator&lt;T&gt; accumulator)</code></td>
</tr>
<tr>
<td><code>reduce(U identity, BiFunction&lt;U,? super T,U&gt; accumulator, BinaryOperator&lt;U&gt; combiner)</code></td>
</tr>
<tr>
<td><code>sorted(Comparator&lt;? super T&gt; comparator)</code></td>
</tr>
<tr>
<td><code>collect(Collector&lt;? super T,A,R&gt; collector)</code></td>
</tr>
<tr>
<td><code>collect &gt; Collectors.toList()</code></td>
</tr>
<tr>
<td><code>collect &gt; Collectors.toSet()</code></td>
</tr>
<tr>
<td><code>collect &gt; Collectors.toMap()</code></td>
</tr>
<tr>
<td><code>collect &gt; Collectors.groupingBy()</code></td>
</tr>
<tr>
<td><code>anyMatch</code></td>
</tr>
</tbody></table>
<p>此外，<code>Function.identity()</code> 比常用，其返回一个函数式接口，这个接口的返回值和输入参数一样，在使用 <code>t -&gt; t</code> 的地方就可以使用它:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a function that always returns its input argument.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the type of the input and output objects to the function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a function that always returns its input argument</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;T&gt; <span class="function">Function&lt;T, T&gt; <span class="title">identity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t -&gt; t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如 <code>ns.stream().collect(Collectors.groupingBy(Function.identity(), Collectors.counting()))</code>。</p>
<h2 id="创建-Stream"><a href="#创建-Stream" class="headerlink" title="创建 Stream"></a>创建 Stream</h2><p>常用创建 Stream 的方法有:</p>
<ul>
<li>Collection.stream() </li>
<li>Stream.of()</li>
<li>Stream.iterate() </li>
<li>Stream.generate()</li>
<li>Arrays.stream()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [1] Collection.stream() 方法创建 Stream</span></span><br><span class="line">Stream&lt;String&gt;  stringStream1  = list.stream();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [2] Stream.of() 方法创建 Stream</span></span><br><span class="line">Stream&lt;String&gt;  stringStream2  = Stream.of(<span class="string">&quot;taobao&quot;</span>);</span><br><span class="line">Stream&lt;Integer&gt; integerStream1 = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [3] Stream.iterate() 方法创建 Stream</span></span><br><span class="line">Stream&lt;Integer&gt; integerStream1 = Stream.iterate(<span class="number">1</span>, item -&gt; item + <span class="number">1</span>).limit(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<h2 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h2><p>遍历集合的元素:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; ns = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        ns.stream().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示: </p>
<ul>
<li>如上简单的遍历集合的元素不能体现 forEach 的优势，需要和 Stream 的其他 API 一起使用时才能体现出来</li>
<li>forEach 中不能使用 break, continue 等</li>
<li>由于 Lambda 的本质是匿名内部类，所以其中使用 return 也只是结束内部类的接口实现的逻辑，并不会影响 forEach 所在的代码块</li>
</ul>
</blockquote>
<h2 id="peek"><a href="#peek" class="headerlink" title="peek"></a>peek</h2><p><code>peek</code> 和 <code>forEach</code> 比较相似，都可以用来遍历 Stream 中的元素，他们的参数都是一个 <code>Consumer&lt;T&gt;</code>，不同的是 <code>forEach</code> 返回值为 <code>void</code>, <code>peek</code> 的返回值为 <code>Stream&lt;T&gt;</code>，所以 <code>forEach</code> 后不能再链式调用 Stream 的其他 API，而 <code>peek</code> 可以。</p>
<h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>对于 Stream 中包含的元素使用给定的过滤函数进行过滤操作，新生成的 Stream 只包含<code>符合条件的元素</code>:</p>
<img src="../img/java/stream-filter.jpg">

<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>对于 Stream 中包含的元素使用给定的转换函数进行转换操作，新生成的 Stream 只包含转换后生成的<code>另一种类型的元素</code>。这个方法有三个对于原始类型的变种方法，分别是：mapToInt，mapToLong 和 mapToDouble。这三个方法也比较好理解，比如 mapToInt 就是把原始 Stream 转换成一个新的 Stream，这个新生成的 Stream 中的元素都是 int 类型，之所以会有这样三个变种方法，可以免除自动装箱/拆箱的额外消耗:</p>
<img src="../img/java/stream-map.jpg">

<blockquote>
<p>提示: 简单一点说，map 的功能就是进行类型转换。</p>
</blockquote>
<h2 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h2><p>当需要<a target="_blank" rel="noopener" href="https://blog.csdn.net/Mark_Chao/article/details/80810030">把 2 层的集合扁平化为 1 层的集合</a> (即<code>List&lt;List&lt;T&gt;&gt; -&gt; List&lt;R&gt;</code>) 时可以使用 flatMap，与 map 类似，都是进行类型转换，但 flatMap 更难理解，我们尝试分析一下，flatMap 的方法声明为 <code>&lt;R&gt; Stream&lt;R&gt; flatMap(Function&lt;? super T,? extends Stream&lt;? extends R&gt;&gt; mapper)</code>，则:</p>
<ul>
<li>mapper 是一个 Function，说明参数个数为 1，返回值的类型是 Stream (与 BiFunction 进行比较下有啥不同 ?)</li>
<li>mapper 的参数类型的泛型是 T，但其实要求 T 是一个集合如 <code>List&lt;String&gt;</code>，或者数组 (如果不是集合或者数组，就没有压扁这回事了)</li>
<li>mapper 的返回类型的泛型是 <code>Stream&lt;R&gt;</code>，这里的 R 是普通类型如 String，不再是集合</li>
<li>既然 mapper function 是把一个集合转为普通类型的 Stream，则可以<ul>
<li>集合:<ul>
<li>使用方法引用 <code>Collection::stream</code> (推荐使用)</li>
<li>集合对象调用 <code>stream()</code> 方法返回 Stream 对象</li>
</ul>
</li>
<li>数组: <ul>
<li>使用方法引用 <code>Stream::of</code> (推荐使用)</li>
<li>调用 <code>Stream.of(array)</code> 返回 Stream 对象</li>
</ul>
</li>
</ul>
</li>
<li>最后 flatMap 把多个 Stream 合并为一个 Stream，实现了把 <code>Stream&lt;List&lt;T&gt;&gt;</code> 转为 <code>Stream&lt;R&gt;</code></li>
</ul>
<p>由于 flatMap 返回值为 <code>Stream&lt;R&gt;</code>，接下来就可以链式调用 Stream 的其他方法继续处理后面的逻辑了。</p>
<img src="../img/java/stream-flatmap.jpg">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;List&lt;String&gt;&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        list.add(Arrays.asList(<span class="string">&quot;One&quot;</span>, <span class="string">&quot;Two&quot;</span>, <span class="string">&quot;Three&quot;</span>));</span><br><span class="line">        list.add(Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Carry&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 二层的集合扁平化为一层的集合</span></span><br><span class="line">        List&lt;String&gt; result = list.stream()</span><br><span class="line">                .flatMap(List::stream)</span><br><span class="line">                .map(String::toUpperCase)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(result); <span class="comment">// [ONE, TWO, THREE, ALICE, BOB, CARRY]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于 flatMap 的参数 Stream，可以有 2 种方法提供:</p>
<ul>
<li>集合对象调用 stream() 转为 Stream</li>
<li>方法引用 Collection::stream</li>
</ul>
<p>下面以把字符串分隔为单词为例:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaTest</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; t1 = Arrays.asList(<span class="string">&quot;Huang Biao&quot;</span>, <span class="string">&quot;Hill Man&quot;</span>)</span><br><span class="line">                .stream()</span><br><span class="line">                .map(e -&gt; Arrays.asList(e.split(<span class="string">&quot; &quot;</span>)))</span><br><span class="line">                .flatMap(e -&gt; e.stream()) <span class="comment">// 或者 List::stream</span></span><br><span class="line">                .collect(Collectors.toList()); <span class="comment">// [Huang, Biao, Hill, Man]</span></span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; t2 = Arrays.asList(<span class="string">&quot;Huang Biao&quot;</span>, <span class="string">&quot;Hill Man&quot;</span>)</span><br><span class="line">                .stream()</span><br><span class="line">                .map(line -&gt; line.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">                .flatMap(Stream::of)</span><br><span class="line">                .collect(Collectors.toList()); <span class="comment">// [Huang, Biao, Hill, Man]</span></span><br><span class="line"></span><br><span class="line">        System.out.println(t1);</span><br><span class="line">        System.out.println(t2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示: 大多数时候使用 flatMap 可以只使用 flat 功能，与 map 功能分开，这样的好处是更容易理解，而不是在 flatMap 里同时做 flat 和 map 的功能，例如上面先把字符串分割为词的 <code>List&lt;List&gt;</code> 然后再扁平化为 <code>List</code>:</p>
<p><code>.stream().map(line -&gt; Arrays.asList(line.split(&quot; &quot;))).flatMap(List::stream)</code></p>
<p>如果直接在 flatMap 中进行字符串分割为词的 <code>List&lt;List&gt;</code> 并且转换为 Stream，则为</p>
<p><code>.stream().flatMap(e -&gt; Arrays.asList(e.split(&quot; &quot;)).stream())</code></p>
<p>虽然代码看上去更少了，但理解起来更难一点。</p>
</blockquote>
<h2 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h2><p>返回一个<code>丢弃原 Stream 的前 N 个元素</code>后剩下元素组成的新 Stream，如果原 Stream 中包含的元素个数小于 N，那么返回空 Stream:</p>
<img src="../img/java/stream-skip.jpg">

<h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><p>对一个 Stream 进行<code>截断</code>操作，获取其<code>前 N 个元素</code>，如果原 Stream 中包含的元素个数小于 N，那就获取其所有的元素:</p>
<img src="../img/java/stream-limit.jpg">

<h2 id="Class-User"><a href="#Class-User" class="headerlink" title="Class User"></a>Class User</h2><p>定义一个用户类，后面的例子基于这个类的对象进行演示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>    id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>    teamId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, String username, <span class="keyword">int</span> teamId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">        <span class="keyword">this</span>.teamId = teamId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        User user = (User) o;</span><br><span class="line">        <span class="keyword">return</span> id == user.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><p>顾名思义，去重使用 (调用对象的  equals 方法进行比较):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = data();</span><br><span class="line">        List&lt;User&gt; temp = users.stream().distinct().collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        System.out.println(temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 准备测试数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; <span class="title">data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">1</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">2</span>, <span class="string">&quot;李四&quot;</span>, <span class="number">1</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">3</span>, <span class="string">&quot;王五&quot;</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">4</span>, <span class="string">&quot;悟空&quot;</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">5</span>, <span class="string">&quot;悟净&quot;</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">4</span>, <span class="string">&quot;大圣&quot;</span>, <span class="number">2</span>),  <span class="comment">// id 与大圣的重复了，认为是同一个对象</span></span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;Alice&quot;</span>, <span class="number">1</span>) <span class="comment">// id 与张三的重复了，认为是同一个对象</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>Stream 接口有一些通用的汇聚操作，比如 <code>reduce()</code> 和 <code>collect()</code>；也有一些特定用途的汇聚操作，比如 <code>sum()</code>,  <code>max()</code> 和 <code>count()</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 collect 创建集合</span></span><br><span class="line">List&lt;Integer&gt; numsWithoutNull = nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 reduce 求和</span></span><br><span class="line">List&lt;Integer&gt; ints = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">int</span> sum1 = ints.stream().reduce((mem, item) -&gt; mem + item).get(); <span class="comment">// 使用 reduce 求和: 无初始值</span></span><br><span class="line"><span class="keyword">int</span> sum2 = ints.stream().reduce(<span class="number">10</span>, (mem, item) -&gt; mem + item);   <span class="comment">// 使用 reduce 求和: 有初始值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 sum 求和</span></span><br><span class="line"><span class="keyword">int</span> sum3 = ints.stream().mapToInt(n -&gt; n).sum();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 求最小值</span></span><br><span class="line"><span class="keyword">int</span>[] nums = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> min = IntStream.of(nums).min().getAsInt();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<code>sum()</code> 方法不是所有的 Stream 对象都有的，只有 IntStream、LongStream 和 DoubleStream 实例才有。</p>
</blockquote>
<h2 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h2><p>使用 Comparator 创建排序规则，作为 sorted 的参数进行排序，需要注意的是默认为升序排序，后面一个 reversed 会取反前面的所有 comparator:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Collections.reverseOrder;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Comparator.comparing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// [1] 按 ID 升序排序</span></span><br><span class="line">        result = data().stream()</span><br><span class="line">                .sorted(Comparator.comparing(User::getId))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// [2] 按 ID 降序排序</span></span><br><span class="line">        result = data().stream()</span><br><span class="line">                .sorted(Comparator.comparing(User::getId).reversed())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// [3] 按 ID 升序，ID 相同时名字升序排序</span></span><br><span class="line">        result = data().stream()</span><br><span class="line">                .sorted(Comparator.comparing(User::getId).thenComparing(User::getUsername))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// [4] 按 ID 升序，ID 相同时名字降序排序</span></span><br><span class="line">        result = data().stream()</span><br><span class="line">                .sorted(comparing(User::getId).thenComparing(reverseOrder(comparing(User::getUsername))))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// [5] Comparator.comparing 创建的排序规则对象 Comparator 可以作为 Collection.sorted 的参数进行排序</span></span><br><span class="line">        List&lt;User&gt; users = data();</span><br><span class="line">        users.sort(Comparator.comparing(User::getId));</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 准备测试数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;User&gt; <span class="title">data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">1</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">2</span>, <span class="string">&quot;李四&quot;</span>, <span class="number">1</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">3</span>, <span class="string">&quot;王五&quot;</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">4</span>, <span class="string">&quot;悟空&quot;</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">5</span>, <span class="string">&quot;悟净&quot;</span>, <span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">4</span>, <span class="string">&quot;大圣&quot;</span>, <span class="number">2</span>),  <span class="comment">// id 与大圣的重复了，认为是同一个对象</span></span><br><span class="line">                <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;Alice&quot;</span>, <span class="number">1</span>) <span class="comment">// id 与张三的重复了，认为是同一个对象</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示: 可以静态导入方法简化代码，如上面的 <code>import static java.util.Collections.reverseOrder</code>。</p>
</blockquote>
<h2 id="toList"><a href="#toList" class="headerlink" title="toList"></a>toList</h2><p>使用 <code>Collectors.toList() </code> 聚合为 List:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; users = data().stream()</span><br><span class="line">    .filter(user -&gt; user.getId() &gt; <span class="number">3</span>)</span><br><span class="line">    .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<h2 id="toSet"><a href="#toSet" class="headerlink" title="toSet"></a>toSet</h2><p>使用 <code>Collectors.toSet()</code> 聚合为 List:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;User&gt; users = data().stream()</span><br><span class="line">    .filter(user -&gt; user.getId() &gt; <span class="number">3</span>)</span><br><span class="line">    .collect(Collectors.toSet());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以指定 Set 的类型: <code>Collectors.toCollection(TreeSet::new)</code> 替换 <code>Collectors.toSet()</code>。</p>
</blockquote>
<h2 id="toMap"><a href="#toMap" class="headerlink" title="toMap"></a>toMap</h2><p>使用 <code>Collectors.toMap()</code> 聚合为 Map，value 为满足条件的对象，例如把 <code>List&lt;User&gt;</code> 转为 <code>Map&lt;Integer, User&gt;</code>，key 为 userId, Value 为 User:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; users = data();</span><br><span class="line">Map&lt;Integer, User&gt; userMap = users.stream().collect(Collectors.toMap(User::getId, u -&gt; u, (o, n) -&gt; o));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示: <code>toMap</code> 的第三个参数是可选参数，当 users 中没有重复 ID 的对象时，可以不需要第三个参数；当有重复 ID 时，由于 Map 插入重复 key 会抛异常，第三个参数的 Lambda 函数决定使用哪一个作为 value。</p>
</blockquote>
<h2 id="groupingBy"><a href="#groupingBy" class="headerlink" title="groupingBy"></a>groupingBy</h2><p>使用 <code>Collectors.groupingBy</code> 进行分组，结果为 Map，key 为分组的条件，value 为满足条件的对象的集合，例如把同一个 team 中的成员放到一组中:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; users = data();</span><br><span class="line">Map&lt;Integer, List&lt;User&gt;&gt; teamUsers = users.stream().collect(Collectors.groupingBy(User::getTeamId));</span><br></pre></td></tr></table></figure>

<p>只取对象中的某个属性:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Long, List&lt;Integer&gt;&gt; optionIdWithStarValuesMap = starOptionAnswers.stream().collect(</span><br><span class="line">        Collectors.groupingBy(</span><br><span class="line">                QuestionOptionAnswer::getQuestionOptionId,</span><br><span class="line">                Collectors.mapping(QuestionOptionAnswer::getValue, Collectors.toList())</span><br><span class="line">        ));</span><br></pre></td></tr></table></figure>

<h2 id="anyMatch"><a href="#anyMatch" class="headerlink" title="anyMatch"></a>anyMatch</h2><p>如果有任何一个元素匹配，返回 true:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; ns = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    ns.add(<span class="number">1</span>);</span><br><span class="line">    ns.add(<span class="number">3</span>);</span><br><span class="line">    ns.add(<span class="number">4</span>);</span><br><span class="line">    ns.add(<span class="number">5</span>);</span><br><span class="line">    System.out.println(ns.stream().anyMatch(n -&gt; n &gt; <span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>还要: <code>findFirst()</code>: Returns an Optional describing the first element of this stream, or an empty Optional if the stream is empty.</p>
</blockquote>
<h2 id="树结构化一个-List"><a href="#树结构化一个-List" class="headerlink" title="树结构化一个 List"></a>树结构化一个 List</h2><p>树形结构的数据，例如地区信息，章节数据等，通常存储到数据库时每个记录存储一行，通过 parentId 来建立树中的父子关系，但是在把数据显示到界面上时需要恢复正常的树形结构，下面的例子把数据库中 2D 的表格数据构造为树结构的数据:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> parentId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Chapter&gt; children = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Setters and Getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 把扁平的章节树结构化，章节放到它的 parent 的 children 中</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> flatChapters 扁平的章节</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 返回树结构化后的章节数组，数组的元素为根节点章节</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Chapter&gt; <span class="title">treefyChapters</span><span class="params">(List&lt;Chapter&gt; flatChapters)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 把扁平的章节数组放到 map 中，加速查找</span></span><br><span class="line">    <span class="comment">// 2. 找到章节的 parent，加入 parent 的 children</span></span><br><span class="line">    <span class="comment">// 3. parent id 为 0，说明是根节点，返回 parent id 为 0 的章节组成的数组</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// [1] 把扁平的章节数组放到 map 中，加速查找</span></span><br><span class="line">    Map&lt;Long, Chapter&gt; chapterMap = flatChapters.stream().collect(Collectors.toMap(Chapter::getId, chapter -&gt; chapter, (oldValue, newValue) -&gt; newValue));</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// [2] 找到章节的 parent，加入 parent 的 children</span></span><br><span class="line">    chapterMap.forEach((id, chapter) -&gt; &#123;</span><br><span class="line">        Chapter parent = chapterMap.get(chapter.getParentId());</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            parent.getChildren().add(chapter);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// [3] 返回 parent id 为 0 的章节组成的数组</span></span><br><span class="line">    List&lt;Chapter&gt; roots = flatChapters.stream().filter(chapter -&gt; chapter.getParentId() == <span class="number">0L</span>).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> roots;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="求最小值"><a href="#求最小值" class="headerlink" title="求最小值"></a>求最小值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] nums = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> min = IntStream.of(nums).min().getAsInt();</span><br></pre></td></tr></table></figure>

<h2 id="int-数组转为-List"><a href="#int-数组转为-List" class="headerlink" title="int 数组转为 List"></a>int 数组转为 List</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] ints = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"> </span><br><span class="line">List&lt;Integer&gt; list1 = IntStream.of(ints).boxed().collect(Collectors.toList());</span><br><span class="line">List&lt;Integer&gt; list2 = Arrays.stream(ints).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<h2 id="频率统计"><a href="#频率统计" class="headerlink" title="频率统计"></a>频率统计</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/29122394/word-frequency-count-java-8">Word frequency count Java 8</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 统计出现频率</span></span><br><span class="line">        List&lt;Integer&gt; ns = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 频率为 Long</span></span><br><span class="line">        Map&lt;Integer, Long&gt; map1 = ns.stream().collect(Collectors.groupingBy(Function.identity(), Collectors.counting()));</span><br><span class="line">        Map&lt;Integer, Long&gt; map2 = ns.stream().collect(Collectors.groupingBy(n -&gt; n, Collectors.counting()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 频率为 Integer</span></span><br><span class="line">        Map&lt;Integer, Integer&gt; map3 = ns.stream().collect(Collectors.groupingBy(Function.identity(), Collectors.summingInt(e -&gt; <span class="number">1</span>)));</span><br><span class="line">        Map&lt;Integer, Integer&gt; map4 = ns.stream().collect(Collectors.groupingBy(n -&gt; n, Collectors.summingInt(e -&gt; <span class="number">1</span>)));</span><br><span class="line"></span><br><span class="line">        System.out.println(map1);</span><br><span class="line">        System.out.println(map2);</span><br><span class="line">        System.out.println(map3);</span><br><span class="line">        System.out.println(map4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;1=1, 2=3, 3=2, 4=1&#125;</span><br><span class="line">&#123;1=1, 2=3, 3=2, 4=1&#125;</span><br><span class="line">&#123;1=1, 2=3, 3=2, 4=1&#125;</span><br><span class="line">&#123;1=1, 2=3, 3=2, 4=1&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>static &lt;T&gt; Function&lt;T,T&gt; identity()</code>: Returns a function that always returns its input argument.</p>
</blockquote>
<h2 id="词频统计"><a href="#词频统计" class="headerlink" title="词频统计"></a>词频统计</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; statements = Arrays.asList(</span><br><span class="line">        <span class="string">&quot;Breaking News Latest News and Videos&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Fox News Breaking News Updates Latest News Headlines&quot;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 每个语句分割为单词数组，得到一个 Stream&lt;List&lt;String&gt;&gt;</span></span><br><span class="line">    <span class="comment">// 2. 把 Stream&lt;List&lt;String&gt;&gt; 扁平化为 Stream&lt;String&gt;</span></span><br><span class="line">    <span class="comment">// 3. 统计词频</span></span><br><span class="line">    Map&lt;String, Long&gt; frequency = statements.stream()</span><br><span class="line">        .map(stmt -&gt; Arrays.asList(stmt.split(<span class="string">&quot; &quot;</span>)))</span><br><span class="line">        .flatMap(List::stream)</span><br><span class="line">        .collect(Collectors.groupingBy(t -&gt; t, Collectors.counting()));</span><br><span class="line">    System.out.println(frequency);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;Headlines=1, Updates=1, Breaking=2, and=1, News=5, Latest=2, Fox=1, Videos=1&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示: 语句中还会有标点符号，多余的空格等，大家根据上面的知识试试怎么处理。</p>
</blockquote>

        
    </div>
    
  </div>
  
  
    
<nav id="article-nav">
  
    <a href="/topology/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          拓扑排序在并行任务调度中的运用
        
      </div>
    </a>
  
  
    <a href="/lambda/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Lambda 笔记</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  

</article>




    <script>
        $(document).ready(function() {
            // 显示 content table
            $('.content-table').show();
            $('.menu .item.non-index-item').show();

            var $tocMask = $('#toc-mask');

            $(document).keyup(function(e) {
                // 按下数字 1，toggle content table
                if (e.keyCode == 49) {
                    // $tocMask.toggle();
                    $tocMask.fadeIn('fast');
                }
            });

            $(document).on('click', '#show-toc-button, .content-table', function() {
                // $tocMask.toggle();
                $tocMask.fadeIn('fast');
            });

            // 隐藏 Mask
            $(document).on('click', '#toc-mask, #toc-mask .toc-link', function() {
                // $tocMask.hide();
                $tocMask.fadeOut('fast');
            });
        });
    </script>

</div>
            <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <p>Hosted by <a target="_blank" rel="noopener" href="https://github.com">Github Pages</a></p>
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> Mod
            </div>
        </div>

        <!-- 卜算子 -->
        
    </div>
</footer>

        </div>
        

<script>
	var yiliaConfig = {
		fancybox: false,
		mathjax: false,
		animate: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<!-- 
<script src="/js/main.js"></script>
 -->

<!--



 -->

    </div>
</body>

</html>
